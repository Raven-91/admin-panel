!function(){"use strict";var e,t={848:function(e,t,s){s(926);var o="https://admin-panel-server-j42c.onrender.com/api";class n{static accessTokenKey="accessToken";static refreshTokenKey="refreshToken";static userInfoKey="userInfo";static async processUnauthorizedResponse(){const e=localStorage.getItem(this.refreshTokenKey);if(e){const t=await fetch(o+"/refresh",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({refreshToken:e})});if(t&&200===t.status){const e=await t.json();if(e&&!e.error)return this.setTokens(e.tokens.accessToken,e.tokens.refreshToken),!0}}return this.removeTokens(),location.href="#/login",!1}static async logout(){const e=localStorage.getItem(this.accessTokenKey);if(e){const t=await fetch(o+"/logout",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({accessToken:e})});if(t&&200===t.status){const e=await t.json();if(e&&!e.error)return this.removeTokens(),localStorage.removeItem(this.userInfoKey),!0}}}static setTokens(e){localStorage.setItem(this.accessTokenKey,e)}static removeTokens(){localStorage.removeItem(this.accessTokenKey)}static setUserInfo(e){localStorage.setItem(this.userInfoKey,JSON.stringify(e))}static getUserInfo(){const e=localStorage.getItem(this.userInfoKey);return e?JSON.parse(e):null}}class i{static async request(e,t="GET",s=null){const o={method:t,headers:{"Content-Type":"application/json",Accept:"application/json"}};let i=localStorage.getItem(n.accessTokenKey);i&&(o.headers["x-auth-token"]=i),s&&(o.body=JSON.stringify(s));const a=await fetch(e,o);if(a.status<200||a.status>=300){if(401===a.status)return await n.processUnauthorizedResponse()?await this.request(e,t,s):null;const o=await a.json().then((e=>JSON.stringify(e)));throw new Error(o||a.message)}return await a.json()}}class a{static showModal(e,t,s){return!!(e&&t&&s)&&(e.style="display: block",t.innerHTML=s,!0)}static closeModal(e){return!!e&&(e.style="display: none",!0)}}class r{static showError(e,t,s){if(e.message){const o=JSON.parse(e.message);return a.showModal(t,s,o.message),!0}return!1}}class l{constructor(e){if(this.userFirstName=null,this.userLastName=null,this.email=null,this.password=null,this.passwordRepeat=null,this.page=e,localStorage.getItem(n.accessTokenKey))return void(location.href="#/main");this.fields=[{name:"email",id:"email",element:null,regex:/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,valid:!1},{name:"password",id:"password",element:null,regex:/^[a-zA-Z0-9+_@.-]*$/,valid:!1}],"signup"===this.page&&(this.fields.unshift({name:"name",id:"userFirstName",element:null,regex:/^([А-ЯЁA-Z][а-яёa-z]+\s*)+$/,valid:!1},{name:"lastName",id:"userLastName",element:null,regex:/^([А-ЯЁA-Z][а-яёa-z]+\s*)+$/,valid:!1}),this.fields.push({name:"repeatPassword",id:"repeatPassword",element:null,regex:/^[a-zA-Z0-9+_@.-]*$/,valid:!1}));const t=this;this.fields.forEach((e=>{e.element=document.getElementById(e.id),e.element.onchange=function(){t.validateField.call(t,e,this)}})),this.userFirstName=document.getElementById("userFirstName"),this.userLastName=document.getElementById("userLastName"),this.email=document.getElementById("email"),this.password=document.getElementById("password"),this.passwordRepeat=document.getElementById("repeatPassword"),this.modalWindow=document.getElementById("modal"),this.modalMessage=document.getElementById("modal-msg"),this.modalClose=document.getElementById("modal-close"),this.modalClose.onclick=function(){a.closeModal(t.modalWindow)},this.form=document.getElementById("form"),this.link=document.getElementById("link"),this.link.onclick=function(){t.followLinks(t.page)},this.actionElement=document.getElementById("action"),this.actionElement.onclick=function(){t.processForm()}}validateField(e,t){t.value&&t.value.match(e.regex)?(e.valid=!0,this.invalidMessage(t,e.valid)):(e.valid=!1,this.invalidMessage(t,e.valid)),this.validateForm()}validateForm(){const e=this.fields.every((e=>e.valid));let t={validForm:e};if("signup"===this.page){if(this.checkPassword=this.password.value===this.passwordRepeat.value,this.checkPassword){const e=!0;this.invalidMessage(this.password,e),this.invalidMessage(this.passwordRepeat,e)}else{const e=!1;this.invalidMessage(this.password,e),this.invalidMessage(this.passwordRepeat,e)}return t.checkPassword=this.checkPassword,this.validForm(t),e}return t.checkPassword=!0,this.validForm(t),e}async processForm(){if(this.validateForm()){const e=this.fields.find((e=>"email"===e.name)).element.value,t=this.fields.find((e=>"password"===e.name)).element.value;if("signup"===this.page)try{const s=await i.request(o+"/signup","POST",{userFirstName:this.fields.find((e=>"name"===e.name)).element.value,userLastName:this.fields.find((e=>"lastName"===e.name)).element.value,email:e,password:t,passwordRepeat:this.fields.find((e=>"repeatPassword"===e.name)).element.value});if(s&&s.error)throw console.log(s),new Error("Error: "+s.error)}catch(e){return r.showError(e,this.modalWindow,this.modalMessage),this.form.reset(),console.log(e)}try{const s=await i.request(o+"/login","POST",{email:e,password:t});if(s){if(s.error||!s.accessToken||!s.userFirstName||!s.userLastName||!s.userEmail||!s.userId)throw new Error(s.message);n.setTokens(s.accessToken),n.setUserInfo({userFirstName:s.userFirstName,userLastName:s.userLastName,userId:s.userId,userEmail:e}),location.href="#/main"}}catch(e){return r.showError(e,this.modalWindow,this.modalMessage),this.form.reset(),console.log(e)}}}invalidMessage(e,t){e&&!t?(e.nextElementSibling.nextElementSibling.style.cssText="display: inline-block;",e.style.cssText="border: 1px solid var(--bs-form-invalid-color);"):(e.nextElementSibling.nextElementSibling.style.cssText="display: none;",e.style.cssText="border: 1px solid var(--bs-border-color);")}validForm(e){e.validForm&&e.checkPassword?this.actionElement.removeAttribute("disabled"):this.actionElement.setAttribute("disabled","disabled")}followLinks(e){switch(e){case"signup":location.href="#/login";break;case"login":location.href="#/signup"}}}class c{constructor(){this.blocked="blocked",this.unlocked="active",this.deleted="deleted",this.userName="",this.users=[],this.userNameElement=document.getElementById("username");const e=this;this.currentUser=n.getUserInfo(),this.checkboxes=document.getElementsByClassName("input-checkbox"),this.selectAllCheckbox=document.getElementById("selectAllCheckbox"),this.selectAllCheckbox.onclick=function(){e.selectAllCheckbox.checked?Array.from(e.checkboxes).forEach((e=>{e.checked&&(e.checked=!1),e.checked=!0,e.setAttribute("checked","checked")})):Array.from(e.checkboxes).forEach((e=>{e.checked||(e.checked=!0),e.checked=!1,e.removeAttribute("checked")}))},this.buttonBlockUser=document.getElementById("block"),this.buttonBlockUser.onclick=function(){e.updateStatusUser(e.blocked)},this.buttonUnlockUser=document.getElementById("unlock"),this.buttonUnlockUser.onclick=function(){e.updateStatusUser(e.unlocked)},this.buttonLogout=document.getElementById("logout"),this.buttonLogout.onclick=function(){e.exitProfile()},this.buttonDeleteUser=document.getElementById("delete"),this.buttonDeleteUser.onclick=function(){e.updateStatusUser(e.deleted)},this.modalWindow=document.getElementById("modal"),this.modalMessage=document.getElementById("modal-msg"),this.modalClose=document.getElementById("modal-close"),this.modalClose.onclick=function(){a.closeModal(e.modalWindow)},this.showNameUser(),this.init()}async init(){try{const e=await i.request(o+"/users");if(e){if(e.error)throw new Error(e.error);this.items=e,this.items.find((e=>{e.email===this.currentUser.userEmail&&e.status===this.blocked&&this.exitProfile()})),this.selectAllCheckbox.checked=!1,this.items.forEach((e=>{this.createItemInTable(e)}))}}catch(e){return r.showError(e,this.modalWindow,this.modalMessage),console.log(e)}}createItemInTable(e){const t=document.getElementById("table_body");if(t){const s=document.createElement("tr");if(s.classList.add("table-row"),s){const t=document.createElement("td"),o=document.createElement("input");o&&(o.classList.add("form-check-input","input-checkbox"),o.setAttribute("type","checkbox"),o.setAttribute("value",e.userId),t.appendChild(o),s.appendChild(t));let n=null;this.createHtmlElement(n,s,`${e.userFirstName} ${e.userLastName}`);let i=null;this.createHtmlElement(i,s,e.email);let a=null;this.createHtmlElement(a,s,e.date);let r=null;this.createHtmlElement(r,s,e.status)}t.appendChild(s)}}showNameUser(){const e=n.getUserInfo();this.userName=`${e.userFirstName} ${e.userLastName}`,this.userNameElement.innerHTML=`Hello, ${this.userName}!`}createHtmlElement(e,t,s){(e=document.createElement("td"))&&(e.innerHTML=s,t.appendChild(e))}updateStatusUser(e){const t=[];if(Array.from(this.checkboxes).forEach((e=>{if(e.checked)return t.push(e.value)})),!(t&&t.length>0))return!1;this.processStatus(t,e)}async processStatus(e,t){if(e&&e.length>0&&t)try{let s;if(s=t===this.deleted?await i.request(o+"/delete","DELETE",{users:e}):await i.request(o+"/update","POST",{users:e,status:t}),s){if(s.error)throw new Error(s.message);t===this.deleted&&e.find((e=>e===this.currentUser.userId))&&this.exitProfile(),this.deletePreviousItems("table-row"),this.init()}}catch(e){return r.showError(e,this.modalWindow,this.modalMessage),console.log(e)}}exitProfile(){n.removeTokens(),localStorage.clear(),location.href="#/login"}deletePreviousItems(e){document.getElementsByClassName(e)&&Array.from(document.getElementsByClassName(e)).forEach((e=>e.remove()))}}class d{constructor(){this.contentElement=document.getElementById("content"),this.titleElement=document.getElementById("page-title"),this.routes=[{route:"#/login",title:"Вход",template:"templates/login.html",load:()=>{new l("login")}},{route:"#/signup",title:"Регистрация",template:"templates/signup.html",load:()=>{new l("signup")}},{route:"#/main",title:"Главная",template:"templates/main.html",load:()=>{new c}}]}async openRoute(){const e=window.location.hash.split("?")[0];if("#/logout"===e)return await n.logout(),void(window.location.href="#/login");const t=this.routes.find((t=>t.route===e));t?(this.contentElement.innerHTML=await fetch(t.template).then((e=>e.text())),this.titleElement.innerText=t.title,t.load()):window.location.href="#/login"}}new class{constructor(){this.router=new d,window.addEventListener("DOMContentLoaded",this.handleRouteChanging.bind(this)),window.addEventListener("popstate",this.handleRouteChanging.bind(this))}handleRouteChanging(){this.router.openRoute()}}}},s={};function o(e){var n=s[e];if(void 0!==n)return n.exports;var i=s[e]={exports:{}};return t[e](i,i.exports,o),i.exports}o.m=t,e=[],o.O=function(t,s,n,i){if(!s){var a=1/0;for(d=0;d<e.length;d++){s=e[d][0],n=e[d][1],i=e[d][2];for(var r=!0,l=0;l<s.length;l++)(!1&i||a>=i)&&Object.keys(o.O).every((function(e){return o.O[e](s[l])}))?s.splice(l--,1):(r=!1,i<a&&(a=i));if(r){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[s,n,i]},o.d=function(e,t){for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={590:0};o.O.j=function(t){return 0===e[t]};var t=function(t,s){var n,i,a=s[0],r=s[1],l=s[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(n in r)o.o(r,n)&&(o.m[n]=r[n]);if(l)var d=l(o)}for(t&&t(s);c<a.length;c++)i=a[c],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(d)},s=self.webpackChunkfrontend=self.webpackChunkfrontend||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var n=o.O(void 0,[926],(function(){return o(848)}));n=o.O(n)}();
//# sourceMappingURL=main.80145500fd9f766ec3b7.js.map